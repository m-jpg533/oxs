<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>DJ RADAR Â· AI NIGHT MODE</title>

<style>
html,body{
  margin:0;
  background:#000;
  overflow:hidden;
  font-family:monospace;
  color:#0f0;
}

/* ===== é›·é”ï¼ˆåªèƒ½çœ‹ï¼Œä¸èƒ½é»ï¼‰ ===== */
#radar{
  position:fixed;
  inset:0;
  width:100vw;
  height:100vh;
  background:radial-gradient(circle,#00ff66 2%,#000 70%);
  animation:spin 4s linear infinite;
  pointer-events:none;   /* ğŸ”¥ é—œéµï¼šä¸åƒé»æ“Š */
  z-index:1;
}
@keyframes spin{
  to{transform:rotate(360deg)}
}

/* ===== HUD ===== */
#hud{
  position:fixed;
  top:12px;
  left:12px;
  z-index:10;
  font-size:16px;
  text-shadow:0 0 10px #00ffcc;
}

/* ===== å•Ÿå‹•å±¤ï¼ˆå”¯ä¸€å¯é»ï¼‰ ===== */
#start{
  position:fixed;
  inset:0;
  background:#000;
  display:flex;
  align-items:center;
  justify-content:center;
  z-index:9999;          /* ğŸ”¥ ä¸€å®šæœ€é«˜ */
}

#start button{
  font-size:22px;
  padding:20px 40px;
  border-radius:18px;
  background:#00ffcc;
  color:#000;
  border:none;
  cursor:pointer;
  pointer-events:auto;
  touch-action:manipulation; /* ğŸ“± æ‰‹æ©Ÿå¿…é» */
}
</style>
</head>

<body>

<!-- é›·é” -->
<div id="radar"></div>

<!-- HUD -->
<div id="hud">
  <div id="status">ğŸ› SYSTEM READY</div>
  <div id="audio">ğŸ”Š AUDIO: LOCKED</div>
</div>

<!-- å•Ÿå‹•å±¤ -->
<div id="start">
  <button id="startBtn">â–¶ TAP TO START AI NIGHT</button>
</div>

<!-- éŸ³æ¨‚ï¼ˆä½ å¯ä»¥æ›æˆè‡ªå·±çš„ï¼‰ -->
<audio id="music" loop playsinline>
  <source src="https://m-jpg533.github.io/oxs/37.mp4" type="audio/mpeg">
</audio>

<script>
/* ===== DOM ===== */
const radar   = document.getElementById("radar");
const music   = document.getElementById("music");
const start   = document.getElementById("start");
const btn     = document.getElementById("startBtn");
const audioUI = document.getElementById("audio");
const WEATHER_URL = "https://script.google.com/macros/s/AKfycbzA20FYmlgY6WPMfv2gwlFGk96zluog-6ICqmfar1qiR6OBJ9jLh9lukGpKI82NzsHc/exec";


/* ===== Audio AI ===== */
let ctx, analyser, data;

function initAudioAI(){
  ctx = new (window.AudioContext || window.webkitAudioContext)();
  const src = ctx.createMediaElementSource(music);
  analyser = ctx.createAnalyser();
  analyser.fftSize = 256;
  data = new Uint8Array(analyser.frequencyBinCount);
  src.connect(analyser);
  analyser.connect(ctx.destination);
  audioTick();
}

/* ===== DROP åµæ¸¬ ===== */
let lastBass = 0;
function audioTick(){
  analyser.getByteFrequencyData(data);
  const bass = data.slice(0,30).reduce((a,b)=>a+b,0)/30;

  if(bass - lastBass > 35){
    radar.style.boxShadow = "0 0 140px #00ffff";
    radar.style.animationDuration = "1.2s";
    setTimeout(()=>{
      radar.style.boxShadow = "";
      radar.style.animationDuration = "4s";
    },120);
  }
  lastBass = bass;
  requestAnimationFrame(audioTick);
}

/* ===== å•Ÿå‹•ï¼ˆæ‰‹æ©Ÿå”¯ä¸€åˆæ³•æ–¹å¼ï¼‰ ===== */
btn.onclick = async ()=>{
  await music.play();          // ğŸ“± è§£é–éŸ³è¨Š
  initAudioAI();               // ğŸ§ å•Ÿå‹•åˆ†æ
  loadTaiwanWeather(); // ğŸŒ å•Ÿå‹•ã€Œå…¨å°æº«åº¦è¼ªæ’­ã€
  
  start.style.display="none";  // ç§»é™¤é®ç½©
  audioUI.innerText="ğŸ”Š AUDIO: LIVE";
};

let weatherList = [];
let weatherIndex = 0;

function loadTaiwanWeather(){
  fetch(WEATHER_URL)
    .then(r => r.json())
    .then(data => {
      weatherList = data;
      showWeather();
      setInterval(showWeather, 8000); // æ¯ 8 ç§’æ›ç¸£å¸‚
    })
    .catch(err=>{
      console.error(err);
	  
    });
}

function showWeather(){
  if(weatherList.length === 0) return;

  const w = weatherList[weatherIndex];

  document.getElementById("status").innerText =
    `ğŸ“ ${w.location}`;
  document.getElementById("audio").innerText =
    `ğŸŒ¡ ${w.temp} Â°C`;

  weatherIndex = (weatherIndex + 1) % weatherList.length;
}

</script>

</body>
</html>
