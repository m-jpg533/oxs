<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>DJ RADAR Â· AUDIO MODE</title>

<style>
html,body{
  margin:0;
  background:#000;
  overflow:hidden;
  font-family:monospace;
}
#radar{
  width:100vw;
  height:100vh;
  background:radial-gradient(circle,#00ffcc 2%,#000 70%);
  animation:spin 6s linear infinite;
}
@keyframes spin{
  from{transform:rotate(0deg)}
  to{transform:rotate(360deg)}
}
#startScreen{
  position:fixed;
  inset:0;
  background:black;
  display:flex;
  justify-content:center;
  align-items:center;
  z-index:10;
}
#startBtn{
  font-size:22px;
  padding:20px 40px;
  border-radius:12px;
  border:none;
  background:#00ffcc;
  color:#000;
}
</style>
</head>

<body>

<div id="radar"></div>

<div id="startScreen">
  <button id="startBtn">â–¶ TAP TO START AUDIO AI</button>
</div>

<audio id="music" loop crossorigin="anonymous">
  <source src="https://m-jpg533.github.io/oxs/37.mp4" type="audio/mpeg">
</audio>

<script>
/* ===== DOM ===== */
const radar = document.getElementById("radar");
const music = document.getElementById("music");
const startBtn = document.getElementById("startBtn");
const screen = document.getElementById("startScreen");
/* ğŸ”— GAS Web Appï¼ˆå›å‚³å…¨å°é™£åˆ—ï¼‰ */
const GAS_URL = "https://script.google.com/macros/s/AKfycbzA20FYmlgY6WPMfv2gwlFGk96zluog-6ICqmfar1qiR6OBJ9jLh9lukGpKI82NzsHc/exec"
;

/* === å…¨å°è³‡æ–™ === */
let weatherList = [];
let index = 0;
/* ===== Audio AI ===== */
let audioCtx, analyser, dataArray;

function initAudioAI(){
  audioCtx = new (window.AudioContext || window.webkitAudioContext)();
  const source = audioCtx.createMediaElementSource(music);
  analyser = audioCtx.createAnalyser();

  analyser.fftSize = 1024;
  dataArray = new Uint8Array(analyser.frequencyBinCount);

  source.connect(analyser);
  analyser.connect(audioCtx.destination);

  analyseLoop();
}

function analyseLoop(){
  analyser.getByteFrequencyData(dataArray);

  const bass = avg(dataArray.slice(0, 40));     // ä½é »
  const mid  = avg(dataArray.slice(40, 120));   // ä¸­é »
  const high = avg(dataArray.slice(120, 256));  // é«˜é »

  driveRadar(bass, mid, high);

  requestAnimationFrame(analyseLoop);
}

function avg(arr){
  return arr.reduce((a,b)=>a+b,0) / arr.length;
}

/* ===== é›·é”é©…å‹• ===== */
function driveRadar(bass, mid, high){
  const glow = 40 + bass * 1.6;
  radar.style.boxShadow = `0 0 ${glow}px rgb(0,255,255)`;

  const speed = Math.max(2, 8 - mid / 40);
  radar.style.animationDuration = speed + "s";
}

/* ===== æ‰‹æ©Ÿå¿…é ˆé»æ“Šå•Ÿå‹• ===== */
startBtn.onclick = async ()=>{
  await music.play();       // âœ… æ‰‹æ©Ÿè§£é–éŸ³è¨Š
  initAudioAI();            // âœ… çœŸéŸ³æ¨‚åˆ†æ
  screen.style.display="none";
};
</script>

</body>
</html>
