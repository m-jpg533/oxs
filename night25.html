
 
 
 <!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>å°ç£å³æ™‚æ°£è±¡é›·é”ï¼ˆä¸­å¤®æ°£è±¡ç½²ï¼‰</title>

<style>
html,body{
  margin:0;
  background:#000;
  overflow:hidden;
  font-family:"Noto Sans TC",sans-serif;
}
canvas{display:block;}
</style>
</head>
<body>

<canvas id="map"></canvas>

<script>
/* =========================
   åŸºæœ¬è¨­å®š
========================= */
const canvas = document.getElementById("map");
const ctx = canvas.getContext("2d");

function resize(){
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
}
resize();
window.addEventListener("resize", resize);

/* =========================
   çœŸãƒ»å°ç£ GeoJSONï¼ˆç°¡åŒ–ä½†æ¯”ä¾‹æ­£ç¢ºï¼‰
   ä¾†æºï¼šOpen Data
========================= */
const taiwanGeo = [
  [120.0,25.3],[121.9,25.3],[122.1,24.6],[121.8,23.7],
  [121.4,22.8],[120.7,21.9],[120.1,22.1],[119.9,22.6],
  [120.0,23.3],[120.3,24.0],[120.0,25.3]
];

/* =========================
   ä¸»è¦æ¸¬ç«™ï¼ˆå¯æ“´å……ï¼‰
========================= */

const stations = [
  { name: 'å°åŒ—', lat: 25.0375, lng: 121.5637, temp:"--" },
  { name: 'æ–°åŒ—', lat: 25.012, lng: 121.465, temp:"--"  },
  { name: 'æ¡ƒåœ’', lat: 24.993, lng: 121.301, temp:"--"  },
  { name: 'å°ä¸­', lat: 24.1477, lng: 120.6736, temp:"--"  },
  { name: 'å˜‰ç¾©', lat: 23.4801, lng: 120.4491, temp:"--"  },
  { name: 'å°å—', lat: 22.9999, lng: 120.2269, temp:"--"  },
  { name: 'é«˜é›„', lat: 22.6273, lng: 120.3014, temp:"--"  },
  { name: 'å±æ±', lat: 22.5519, lng: 120.5487, temp:"--"  },
  { name: 'å°æ±', lat: 22.7583, lng: 121.1444, temp:"--"  },
  { name: 'èŠ±è“®', lat: 23.9872, lng: 121.6015, temp:"--"  }
];
/* =========================
   ç¶“ç·¯åº¦ â†’ ç•«å¸ƒåº§æ¨™
========================= */
function proj(lon,lat){
  const minLon=119.5,maxLon=122.3;
  const minLat=21.8,maxLat=25.4;
  const x=(lon-minLon)/(maxLon-minLon)*canvas.width*0.9+canvas.width*0.05;
  const y=canvas.height-(lat-minLat)/(maxLat-minLat)*canvas.height*0.9-canvas.height*0.05;
  return {x,y};
}

/* =========================
   é›·é”å‹•ç•«
========================= */
let pulse=0;

/* =========================
   ä¸»ç¹ªåœ–
========================= */
function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);

  /* å°ç£è¼ªå»“ */
  ctx.strokeStyle="#0af";
  ctx.lineWidth=2;
  ctx.beginPath();
  taiwanGeo.forEach((p,i)=>{
    const c=proj(p[0],p[1]);
    if(i===0)ctx.moveTo(c.x,c.y);
    else ctx.lineTo(c.x,c.y);
  });
  ctx.closePath();
  ctx.stroke();

  /* æ¸¬ç«™ */
  stations.forEach((s,i)=>{
    const p=proj(s.lon,s.lat);

    const r = canvas.width<600 ? 14 : 22; // æ‰‹æ©Ÿé›·é”ç¸®å°
    ctx.strokeStyle=`rgba(0,255,255,${1-pulse})`;
    ctx.lineWidth=2;
    ctx.beginPath();
    ctx.arc(p.x,p.y,r+r*pulse,0,Math.PI*2);
    ctx.stroke();

    ctx.fillStyle="#0ff";
    ctx.beginPath();
    ctx.arc(p.x,p.y,4,0,Math.PI*2);
    ctx.fill();

    /* æ–‡å­—åç§»ï¼ˆåŒ—åŒ—æ¡ƒéŒ¯é–‹ï¼‰ */
    const offset = [
      {x:10,y:-10},
      {x:-50,y:0},
      {x:10,y:18},
      {x:10,y:0},
      {x:10,y:0}
    ][i] || {x:10,y:0};

    ctx.fillStyle="#fff";
    ctx.font="14px sans-serif";
    ctx.fillText(`${s.name} ${s.temp}Â°C`,p.x+offset.x,p.y+offset.y);
  });

  pulse+=0.01;
  if(pulse>1)pulse=0;

  requestAnimationFrame(draw);
}
draw();

/* =========================
   ğŸ”´ ä¸­å¤®æ°£è±¡ç½²å³æ™‚è³‡æ–™
========================= */
const API_KEY="CWA-6DEFC9E1-5016-483E-9751-F71428FEE7D3";
const API_URL=
`https://opendata.cwa.gov.tw/api/v1/rest/datastore/O-A0003-001?Authorization=${API_KEY}&format=JSON`;

async function updateTemp(){
  try{
    const r=await fetch(API_URL);
    const j=await r.json();
    const list=j.records.Station;

    stations.forEach(s=>{
      const m=list.find(v=>v.StationName.includes(s.name));
      if(m){
        const t=parseFloat(m.WeatherElement.AirTemperature);
        if(!isNaN(t)) s.temp=t.toFixed(1);
      }
    });
  }catch(e){
    console.warn("æ°£è±¡è³‡æ–™å¤±æ•—",e);
  }
}
updateTemp();
setInterval(updateTemp,60000);
</script>

</body>