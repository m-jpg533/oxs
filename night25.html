
 <!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<title>å°ç£å³æ™‚é›·é”æ¸¬ç«™ï¼ˆå«å³æ™‚æº«åº¦ï¼‰</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<style>
html,body,#map{
  margin:0;
  width:100%;
  height:100%;
  background:#000;
}
.station-label{
  color:#0ff;
  font-size:12px;
  white-space:nowrap;
  text-shadow:0 0 4px #0ff;
}
</style>
</head>

<body>
<div id="map"></div>

<script>
/* =========================
   åœ°åœ–
========================= */
const map = L.map('map',{
  center:[23.7,121],
  zoom:7,
  zoomControl:false
});

L.tileLayer(
  'https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png'
).addTo(map);

/* =========================
   æ¸¬ç«™
========================= */
const stations = [
  { name:"è‡ºåŒ—", lat:25.0375, lng:121.5637 },
  { name:"æ–°åŒ—", lat:25.0120, lng:121.4650 },
  { name:"æ¡ƒåœ’", lat:24.9930, lng:121.3010 },
  { name:"è‡ºä¸­", lat:24.1477, lng:120.6736 },
  { name:"å˜‰ç¾©", lat:23.4801, lng:120.4491 },
  { name:"è‡ºå—", lat:22.9999, lng:120.2269 },
  { name:"é«˜é›„", lat:22.6273, lng:120.3014 },
  { name:"å±æ±", lat:22.5519, lng:120.5487 },
  { name:"è‡ºæ±", lat:22.7583, lng:121.1444 },
  { name:"èŠ±è“®", lat:23.9872, lng:121.6015 }
];

/* Marker & Label */
stations.forEach(s=>{
  s.label = L.marker([s.lat,s.lng],{
    icon:L.divIcon({
      className:'station-label',
      html:`${s.name} --Â°C`,
      iconAnchor:[-10,-10]
    })
  }).addTo(map);

  const radar = L.circle([s.lat,s.lng],{
    radius:25000,
    color:'#0ff',
    opacity:0.6,
    fillOpacity:0
  }).addTo(map);

  let grow=true;
  setInterval(()=>{
    let r = radar.getRadius();
    radar.setRadius(grow ? r+1200 : r-1200);
    if(r>42000) grow=false;
    if(r<20000) grow=true;
  },120);
});

/* =========================
   ğŸŒ¡ ä¸­å¤®æ°£è±¡ç½²å³æ™‚æº«åº¦
========================= */
const API_KEY = "CWA-6DEFC9E1-5016-483E-9751-F71428FEE7D3";
const API_URL =
`https://opendata.cwa.gov.tw/api/v1/rest/datastore/O-A0003-001?Authorization=${API_KEY}&format=JSON`;

async function updateTemperature(){
  try{
    const res = await fetch(API_URL);
    const data = await res.json();
    const list = data.records.Station;

    stations.forEach(s=>{
      const m = list.find(v => v.StationName.includes(s.name));
      if(m){
        const t = parseFloat(m.WeatherElement.AirTemperature);
        if(!isNaN(t)){
          s.label.setIcon(
            L.divIcon({
              className:'station-label',
              html:`${s.name} ${t.toFixed(1)}Â°C`,
              iconAnchor:[-10,-10]
            })
          );
        }
      }
    });
  }catch(e){
    console.warn("æº«åº¦æ›´æ–°å¤±æ•—",e);
  }
}

updateTemperature();
setInterval(updateTemperature, 10*60*1000);
</script>

</body>
</html>
