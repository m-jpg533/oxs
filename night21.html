<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AI DJ RADAR Â· DROP MODE</title>

<style>
html,body{
  margin:0;
  background:black;
  overflow:hidden;
  font-family:monospace;
  color:#0f0;
}
#radar{
  width:100vw;
  height:100vh;
  background:radial-gradient(circle,#00ff66,#000 70%);
  animation:spin 4s linear infinite;
}
@keyframes spin{to{transform:rotate(360deg)}}

#hud{
  position:fixed;
  top:12px;
  left:12px;
  z-index:10;
  text-shadow:0 0 10px #0f0;
}

#start{
  position:fixed;
  inset:0;
  background:black;
  display:flex;
  align-items:center;
  justify-content:center;
  z-index:99;
}
button{
  font-size:22px;
  padding:20px 40px;
  border-radius:16px;
  background:#00ffcc;
  border:none;
}
</style>
</head>

<body>

<div id="radar"></div>

<div id="hud">
  <div id="loc">ğŸ“ --</div>
  <div id="temp">ğŸŒ¡ -- Â°C</div>
  <div id="wx">â˜ï¸ --</div>
</div>

<div id="start">
  <button onclick="start()">â–¶ TAP TO START DROP</button>
</div>

<audio id="music" loop crossorigin="anonymous">
  <source src="https://m-jpg533.github.io/oxs/37.mp4"type="audio/mp4">
</audio>

<script>
const GAS_URL = "https://script.google.com/macros/s/AKfycbyc_9hqY2ks-9XGxMAy5cHSvGYaELvw_HKypoj5Gx9frB3ikg6uodC0zNmIJCy47f/exec";

const radar = document.getElementById("radar");
const music = document.getElementById("music");

let ctx, analyser, data;
let weather=[], i=0;

/* ğŸ§ çœŸ DROP åµæ¸¬ */
function audioAI(){
  ctx = new (window.AudioContext||window.webkitAudioContext)();
  const src = ctx.createMediaElementSource(music);
  analyser = ctx.createAnalyser();
  analyser.fftSize = 256;
  data = new Uint8Array(analyser.frequencyBinCount);
  src.connect(analyser);
  analyser.connect(ctx.destination);
  tick();
}

let lastBass=0;
function tick(){
  analyser.getByteFrequencyData(data);
  const bass = data.slice(0,30).reduce((a,b)=>a+b,0)/30;

  if(bass-lastBass>35){
    radar.style.boxShadow="0 0 120px #00ffff";
    radar.style.animationDuration="1.2s";
    setTimeout(()=>{
      radar.style.boxShadow="";
      radar.style.animationDuration="4s";
    },120);
  }
  lastBass=bass;
  requestAnimationFrame(tick);
}

/* ğŸŒ¦ å…¨å°å³æ™‚æ°£æº« */
function loadWeather(){
  fetch(GAS_URL)
    .then(r=>r.json())
    .then(d=>{
      weather=d;
      show();
      setInterval(show,8000);
    });
}

function show(){
  const w=weather[i];
  document.getElementById("loc").innerText="ğŸ“ "+w.location;
  document.getElementById("temp").innerText=`ğŸŒ¡ ${w.temp} Â°C`;
  document.getElementById("wx").innerText="â˜ï¸ "+w.weather;

  if(w.weather.includes("é›¨")){
    radar.style.background="radial-gradient(circle,#0099ff,#000)";
  }else if(w.temp<10){
    radar.style.background="radial-gradient(circle,#aa66ff,#000)";
  }else{
    radar.style.background="radial-gradient(circle,#00ff66,#000)";
  }
  i=(i+1)%weather.length;
}

/* â–¶ å•Ÿå‹• */
<!-- function start(){
  music.play();     // ğŸ“± æ‰‹æ©Ÿå¿…æœ‰è²
  audioAI();        // DROP
  loadWeather();    // å…¨å°å³æ™‚
  document.getElementById("start").style.display="none";
} -->
async function start(){
  try{
    await music.play();
    audioAI();
    loadWeather();
    document.getElementById("start").style.display="none";
  }catch(e){
    alert("è«‹å†é»ä¸€æ¬¡å•Ÿå‹•ï¼ˆæ‰‹æ©Ÿéœ€è¦æ‰‹å‹¢ï¼‰");
  }
}

</script>

</body>
</html>
