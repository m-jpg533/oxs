<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<title>å…¨å°å³æ™‚æ°£æº«</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  margin: 0;
  background: #000;
  color: #0ff;
  font-family: system-ui;
}
#list {
  padding: 20px;
}
.item {
  padding: 8px 0;
  border-bottom: 1px solid #033;
}
.temp {
  color: #ff0;
}
</style>
</head>

<body>
<div id="list">è®€å–ä¸­...</div>

<script>
fetch("https://script.google.com/macros/s/AKfycbyAqOofycA-Q8XG02q249kgNzWDsyDooGlkHilxtVHxXwVi54h12HFy-eP46ysOvzu-/exec")
  .then(r => r.json())
  .then(data => {
    document.getElementById("list").innerHTML =
      data.map(d =>
        `<div class="item">
          ${d.county}${d.town}ï¼ˆ${d.name}ï¼‰
          <span class="temp">${d.temp}Â°C</span>
        </div>`
      ).join("");
  })
  .catch(() => {
    document.getElementById("list").innerText = "è®€å–å¤±æ•—";
  });
  function groupByCountyDistrictVillage(stations){
  const tree = {};

  stations.forEach(s => {
    const county   = s.county;
    const district = s.town || s.district;
    const village  = s.village || s.location || "æœªçŸ¥é‡Œ";
    const temp     = Number(s.temp);

    // âŒ éæ¿¾ç„¡æ•ˆè³‡æ–™ï¼ˆ-99 å•é¡Œå°±åœ¨é€™ï¼‰
    if(!county || !district || isNaN(temp) || temp <= -50 || temp >= 60){
      return;
    }

    // ç¸£å¸‚
    if(!tree[county]) tree[county] = {};

    // å€ / é„‰é®
    if(!tree[county][district]) tree[county][district] = {};

    // é‡Œ / æ¸¬ç«™
    if(!tree[county][district][village]){
      tree[county][district][village] = [];
    }

    tree[county][district][village].push(temp.toFixed(1));
  });

  return tree;
}
const data = groupByCountyDistrictVillage(stations);

let html = "";

Object.entries(data).forEach(([county, districts])=>{
  html += `<h2>ğŸ“ ${county}</h2>`;

  Object.entries(districts).forEach(([dist, villages])=>{
    html += `<div style="margin-left:20px"><b>ğŸ˜ ${dist}</b></div>`;

    Object.entries(villages).forEach(([village, temps])=>{
      html += `
        <div style="margin-left:40px">
          â€¢ ${village}ï¼š${temps.join("ã€")} Â°C
        </div>`;
    });
  });
});

document.getElementById("hud").innerHTML = html;

</script>
</body>
</html>
